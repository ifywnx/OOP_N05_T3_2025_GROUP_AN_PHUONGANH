<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8"><title>üíæ T·∫°o Giao d·ªãch</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-light">
<div class="container mt-4">
  <h2>üíæ T·∫°o Giao d·ªãch</h2>

  <div th:if="${lineItemError}" class="alert alert-danger" th:text="${lineItemError}"></div>

  <form th:action="@{/giaodich/save}" th:object="${giaoDich}" method="post" class="card p-4">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">M√£ giao d·ªãch</label>
        <input class="form-control" th:field="*{maGiaoDich}">
        <div class="text-danger small" th:errors="*{maGiaoDich}"></div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Ng√†y giao d·ªãch</label>
        <input type="date" class="form-control" th:field="*{ngayGiaoDich}">
        <div class="text-danger small" th:errors="*{ngayGiaoDich}"></div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Gi·ªù giao d·ªãch</label>
        <input type="time" class="form-control" th:field="*{gioGiaoDich}">
        <div class="text-danger small" th:errors="*{gioGiaoDich}"></div>
      </div>
    </div>

    <hr class="my-4">

    <div class="mb-2">
      <label class="form-label me-3">Ch√≠nh s√°ch gi·∫£m gi√°:</label>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="policy" value="NONE" checked>
        <label class="form-check-label">Kh√¥ng gi·∫£m</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="policy" value="VIP">
        <label class="form-check-label">VIP (-10%)</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="policy" value="SEASONAL">
        <label class="form-check-label">Seasonal (-15%)</label>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="m-0">D√≤ng h√†ng</h5>
      <button type="button" class="btn btn-outline-secondary btn-sm" id="btnAddLine">+ Th√™m d√≤ng</button>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
        <tr><th style="width:45%">S·∫£n ph·∫©m</th><th style="width:20%">S·ªë l∆∞·ª£ng</th><th style="width:20%">ƒê∆°n gi√°</th><th style="width:15%"></th></tr>
        </thead>
        <tbody id="lineItems">
        <tr class="line">
          <td>
            <select name="sanPhamIds" class="form-select" required>
              <option value="" disabled selected>‚Äî Ch·ªçn s·∫£n ph·∫©m ‚Äî</option>
              <option th:each="sp : ${dsSanPham}" th:value="${sp.id}" th:text="${sp.tenSanPham}">S·∫£n ph·∫©m</option>
            </select>
          </td>
          <td><input type="number" name="soLuongs" class="form-control" min="1" value="1" required></td>
          <td><input type="number" name="donGias" class="form-control" min="0" step="1000" value="0" required></td>
          <td><button type="button" class="btn btn-outline-danger btn-sm btnRemove">X√≥a</button></td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-3 d-flex gap-2">
      <button type="submit" class="btn btn-primary">L∆∞u giao d·ªãch</button>
      <a th:href="@{/giaodich}" class="btn btn-secondary">‚¨Ö Quay l·∫°i</a>
    </div>
  </form>
</div>

<script>
const lineItems = document.getElementById('lineItems');
document.getElementById('btnAddLine').addEventListener('click', () => {
  const row = lineItems.querySelector('.line').cloneNode(true);
  row.querySelectorAll('input').forEach(i => i.value = i.name==='soLuongs' ? 1 : 0);
  row.querySelector('select').selectedIndex = 0;
  lineItems.appendChild(row);
});
lineItems.addEventListener('click', (e) => {
  if(e.target.classList.contains('btnRemove')){
    const rows = lineItems.querySelectorAll('.line');
    if(rows.length > 1) e.target.closest('.line').remove();
  }
});
</script>
</body>
</html>
